{% extends "base.html" %}

{% block title %}‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏∞‡∏ö‡∏ö - ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏•‡∏≤{% endblock %}

{% block content %}
<h2 style="margin-bottom: 10px;">‚öôÔ∏è ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏∞‡∏ö‡∏ö (Admin Dashboard)</h2>

<h3 style="margin-top: 20px;">üë• ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</h3>

<!-- ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ -->
<form method="GET" action="{{ url_for('admin_search') }}" class="search-form">
  <input type="text" name="q" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ..." required>
  <button type="submit" class="btn-blue">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
</form>

<!-- ‡∏õ‡∏∏‡πà‡∏°‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏à‡∏≤‡∏Å Excel -->
<div style="margin-bottom: 15px; display: flex; gap: 10px;">
  <a href="{{ url_for('import_users') }}" class="btn-blue">üì• ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏à‡∏≤‡∏Å Excel</a>
  <a href="{{ url_for('download_user_template') }}" class="btn-blue" download>üìÑ ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏ó‡∏°‡πÄ‡∏û‡∏•‡∏ï Excel</a>
</div>
<!-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ -->
<div class="table-container">
  <table class="user-table">
    <thead>
  <tr>
    <th>‡∏•‡∏≥‡∏î‡∏±‡∏ö</th>
    <th>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</th>
    <th>‡πÅ‡∏ú‡∏ô‡∏Å</th>  <!-- ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á -->
    <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</th>
    <th>‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó</th>
    <th>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏•‡∏≤</th>
  </tr>
</thead>
<tbody>
  {% for user in users %}
  <tr>
    <td>{{ loop.index }}</td>
    <td>{{ user.prefix or '' }} {{ user.first_name or '-' }} {{ user.last_name or '' }}</td>
    <td>{{ user.department or '-' }}</td>  <!-- ‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏ú‡∏ô‡∏Å‡πÅ‡∏ó‡∏ô‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó -->

    <!-- ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô -->
    <td>
      {% if user.username != session['username'] %}
      <form method="POST" action="{{ url_for('change_password', user_id=user.id) }}" class="inline-form">
        <input type="text" name="new_password" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà" required>
        <button type="submit" class="btn-blue">‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô</button>
      </form>
      {% else %}
        <span class="text-muted">(‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏≠‡∏á)</span>
      {% endif %}
    </td>

    <!-- ‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó (‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡πÑ‡∏ß‡πâ‡πÉ‡∏´‡πâ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡πÄ‡∏î‡∏¥‡∏°) -->
    <td>
      {% if user.username != session['username'] %}
      <form method="POST" action="{{ url_for('change_role', user_id=user.id) }}" class="inline-form">
        <select name="role" required>
          <option value="staff" {% if user.role == 'staff' %}selected{% endif %}>‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£</option>
          <option value="admin" {% if user.role == 'admin' %}selected{% endif %}>‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</option>
        </select>
        <button type="submit" class="btn-blue">‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô</button>
      </form>
      {% else %}
        <span class="text-muted">(‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏≠‡∏á)</span>
      {% endif %}
    </td>

    <!-- ‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏•‡∏≤ -->
    <td>
      <a href="{{ url_for('view_user_leaves', user_id=user.id) }}" class="btn-blue">üìÑ ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏•‡∏≤</a>
    </td>
  </tr>
  {% endfor %}
</tbody>
  </table>
</div>

<style>
  .search-form {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
  }

  .table-container {
    overflow-x: auto;
    background: #fff;
    padding: 15px;
    border-radius: 10px;
    box-shadow: 0 0 12px rgba(0, 0, 0, 0.08);
  }

  .user-table {
    width: 100%;
    border-collapse: collapse;
    font-family: 'Segoe UI', sans-serif;
  }

  .user-table thead {
    background-color: #f2f2f2;
  }

  .user-table th,
  .user-table td {
    padding: 10px 12px;
    border: 1px solid #ddd;
    text-align: center;
  }

  .user-table tbody tr:nth-child(even) {
    background-color: #f9f9f9;
  }

  .inline-form {
    display: flex;
    gap: 5px;
    align-items: center;
    justify-content: center;
  }

  .inline-form input[type="text"],
  .inline-form select {
    padding: 4px 6px;
    border-radius: 4px;
    border: 1px solid #ccc;
    width: 120px;
  }

  .btn-blue {
    background-color: #007BFF;
    color: white;
    border: none;
    padding: 6px 10px;
    border-radius: 5px;
    cursor: pointer;
  }

  .btn-blue:hover {
    background-color: #0056b3;
  }

  .text-muted {
    color: #888;
    font-style: italic;
  }
</style>
{% endblock %}
