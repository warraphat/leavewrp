{% extends "base.html" %}

{% block title %}‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏•‡∏≤‡∏Ç‡∏≠‡∏á {{ user.first_name }}{% endblock %}

{% block content %}
<h2>üìÑ ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏•‡∏≤‡∏Ç‡∏≠‡∏á {{ user.prefix or '' }}{{ user.first_name }} {{ user.last_name }}</h2>

<!-- ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Å‡∏£‡∏≠‡∏á‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏î‡∏∑‡∏≠‡∏ô -->
<form method="get" class="filter-form" style="margin-bottom: 1em; display: flex; gap: 10px; align-items: center;">
  <label for="start_month">‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡πÄ‡∏î‡∏∑‡∏≠‡∏ô:</label>
  <input type="month" id="start_month" name="start_month" value="{{ request.args.get('start_month', '') }}">

  <label for="end_month">‡∏ñ‡∏∂‡∏á‡πÄ‡∏î‡∏∑‡∏≠‡∏ô:</label>
  <input type="month" id="end_month" name="end_month" value="{{ request.args.get('end_month', '') }}">

  <button type="submit" class="btn-blue">‡∏Å‡∏£‡∏≠‡∏á</button>
  <a href="{{ url_for('export_user_leaves', user_id=user.id, start_month=request.args.get('start_month'), end_month=request.args.get('end_month')) }}" class="btn-blue">
    ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î Excel
  </a>
</form>

<!-- ‚úÖ ‡∏™‡∏£‡∏∏‡∏õ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô‡∏•‡∏≤ -->
<!-- ‚úÖ ‡∏™‡∏£‡∏∏‡∏õ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô‡∏•‡∏≤ -->
<div class="summary-box">
  <h3>üìå ‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡∏•‡∏≤‡∏Ç‡∏≠‡∏á {{ user.first_name }}</h3>
  <ul>
    <li>
      ‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢:
      <span class="highlight 
        {% if summary['‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢'] >= 10 %}danger
        {% elif summary['‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢'] >= 6 %}warning
        {% else %}normal{% endif %}">
        {{ summary['‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢'] }}
      </span> ‡∏ß‡∏±‡∏ô
    </li>
    <li>
      ‡∏•‡∏≤‡∏Å‡∏¥‡∏à:
      <span class="highlight 
        {% if summary['‡∏•‡∏≤‡∏Å‡∏¥‡∏à'] >= 10 %}danger
        {% elif summary['‡∏•‡∏≤‡∏Å‡∏¥‡∏à'] >= 6 %}warning
        {% else %}normal{% endif %}">
        {{ summary['‡∏•‡∏≤‡∏Å‡∏¥‡∏à'] }}
      </span> ‡∏ß‡∏±‡∏ô
    </li>
    <li>
      ‡∏•‡∏≤‡∏¢‡πà‡∏≠‡∏¢:
      <span class="highlight 
        {% if summary['‡∏•‡∏≤‡∏¢‡πà‡∏≠‡∏¢'] >= 10 %}danger
        {% elif summary['‡∏•‡∏≤‡∏¢‡πà‡∏≠‡∏¢'] >= 6 %}warning
        {% else %}normal{% endif %}">
        {{ "%.1f"|format(summary['‡∏•‡∏≤‡∏¢‡πà‡∏≠‡∏¢']) }}
      </span> ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á
    </li>
  </ul>
</div>

<!-- ‚úÖ ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÉ‡∏ö‡∏•‡∏≤ -->
<table class="leave-table" border="1" cellpadding="8" cellspacing="0" style="margin-top: 1em; width: 100%; border-collapse: collapse;">
  <thead style="background: #f0f0f0;">
    <tr>
      <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°</th>
      <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î</th>
      <th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏•‡∏≤</th>
      <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô</th>
      <th>‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•</th>
      <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á</th>
      <th>‡πÄ‡∏ß‡∏•‡∏≤ (‡∏à‡∏≤‡∏Å - ‡∏ñ‡∏∂‡∏á)</th>
      <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
      <th>üóë ‡∏•‡∏ö</th>
    </tr>
  </thead>
  <tbody>
    {% for leave in leaves %}
    <tr>
      <td>
        {% if leave.start_date %}
          {{ leave.start_date.strftime('%d %b %Y') }}
        {% elif leave.date %}
          {{ leave.date.strftime('%d %b %Y') }}
        {% else %}
          -
        {% endif %}
      </td>
      <td>
        {% if leave.end_date %}
          {{ leave.end_date.strftime('%d %b %Y') }}
        {% elif leave.date %}
          {{ leave.date.strftime('%d %b %Y') }}
        {% else %}
          -
        {% endif %}
      </td>
      <td>{{ leave.leave_type }}</td>
      <td>{{ leave.days }} ‡∏ß‡∏±‡∏ô</td>
      <td>{{ leave.reason }}</td>
      <td>
        {% if leave.leave_type == '‡∏•‡∏≤‡∏¢‡πà‡∏≠‡∏¢' %}
          {{ leave.hours or '-' }} ‡∏ä‡∏°.
        {% else %}
          -
        {% endif %}
      </td>
      <td>
        {% if leave.leave_type == '‡∏•‡∏≤‡∏¢‡πà‡∏≠‡∏¢' %}
          {{ leave.time_from or '-' }} - {{ leave.time_to or '-' }}
        {% else %}
          -
        {% endif %}
      </td>
      <td class="status-{{ leave.status }}">{{ leave.status }}</td>
      <td>
        <form method="POST" action="{{ url_for('delete_leave', leave_id=leave.id) }}"
          onsubmit="return confirm('‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡πÉ‡∏ö‡∏•‡∏≤‡∏ô‡∏µ‡πâ?');">
          <button type="submit" class="btn-red">üóë</button>
        </form>
      </td>
    </tr>
    {% else %}
    <tr>
      <td colspan="8" style="text-align: center;">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏•‡∏≤‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</td>
    </tr>
    {% endfor %}
  </tbody>
</table>
<h3>üìé ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏û‡∏π‡∏î‡∏Ñ‡∏∏‡∏¢/‡∏ï‡∏±‡∏Å‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</h3>

<ul>
  {% for note in user.notes %}
    <li>
      üìÑ <a href="{{ url_for('static', filename=note.filepath) }}" target="_blank">{{ note.filename }}</a>
      <small>‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏°‡∏∑‡πà‡∏≠ {{ note.uploaded_at.strftime('%d/%m/%Y') }}</small>
      <form method="POST" action="{{ url_for('delete_user_note', note_id=note.id) }}" style="display:inline;">
        <button class="btn-red" onclick="return confirm('‡∏•‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ô‡∏µ‡πâ?')">‡∏•‡∏ö</button>
      </form>
    </li>
  {% else %}
    <li><em>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</em></li>
  {% endfor %}
</ul>

<!-- ‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏ô‡∏ö‡πÑ‡∏ü‡∏•‡πå -->
<form method="POST" action="{{ url_for('upload_user_note', user_id=user.id) }}" enctype="multipart/form-data">
  <input type="file" name="file" required>
  <button type="submit" class="btn-blue">üìé ‡πÅ‡∏ô‡∏ö‡πÑ‡∏ü‡∏•‡πå</button>
</form>
<br>
<a href="{{ url_for('admin_dashboard') }}" class="btn-blue">‚Üê ‡∏Å‡∏•‡∏±‡∏ö</a>

<style>
  .summary-box {
    background-color: #f9f9f9;
    padding: 12px 16px;
    border-left: 6px solid #007BFF;
    border-radius: 8px;
    margin-top: 1em;
  }
  .summary-box h3 {
    margin-top: 0;
  }
  .summary-box ul {
    margin: 0;
    padding-left: 20px;
  }
  .summary-box li {
    margin-bottom: 4px;
  }
  .status-‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ {
    color: green;
    font-weight: bold;
  }
  .status-‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ {
    color: orange;
    font-weight: bold;
  }
  .status-‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ {
    color: red;
    font-weight: bold;
  }

  .btn-red {
    background-color: #dc3545;
    color: white;
    border: none;
    padding: 6px 10px;
    border-radius: 5px;
    cursor: pointer;
    font-weight: bold;
  }

  .btn-red:hover {
    background-color: #a71d2a;
  }
</style>
{% endblock %}
